{% extends "base.html" %}
{% block content %}

<!-- Hero nag≈Ç√≥wek -->
<div class="text-center my-5">
  <h3 class="fw-bold display-6">Nasze produkty</h3>
</div>

<!-- Kategorie w formie kart -->
<div class="container mb-5">
  <div class="d-flex flex-wrap justify-content-center gap-3">

    {% set categories = [
      ('all', 'üßâ', 'Wszystkie'),
      ('Relax', 'üåô', 'Relax'),
      ('Wspomaganie odchudzania', '‚öñÔ∏è', 'Odchudzanie'),
      ('Yerba klasyczna', 'üåø', 'Klasyczna'),
      ('Odporno≈õƒá', 'üõ°Ô∏è', 'Odporno≈õƒá'),
      ('Energia i pobudzenie', '‚ö°', 'Energia'),
      ('Yerba owocowa', 'üçì', 'Owocowa'),
      ('Yerba z herbatƒÖ', 'üçµ', 'Z herbatƒÖ')
    ] %}

    {% for value, icon, label in categories %}
      <a href="{{ url_for('main.index', category=value) }}" class="text-decoration-none">
        <div class="card text-center shadow-sm px-3 py-2
                    {% if selected_category == value %} border-success bg-success text-white {% else %} border-light {% endif %}">
          <div class="d-flex flex-column align-items-center">
            <div class="fs-4">{{ icon }}</div>
            <small class="fw-bold">{{ label }}</small>
          </div>
        </div>
      </a>
    {% endfor %}

  </div>
</div>


<!-- Produkty -->
<div class="row margin-b">
  {% if products %}
    {% for product in products %}
      <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
        <div class="card product-card h-100 border-0 shadow-sm">

          <!-- Klikalne zdjƒôcie -->
          <a href="{{ url_for('main.product_detail', product_id=product.id) }}" class="text-decoration-none">
            {% if product.image_url %}
              <div class="ratio ratio-1x1">
                <img src="{{ product.image_url }}" class="card-img-top object-fit-cover rounded-top" alt="{{ product.name }}">
              </div>
            {% else %}
              <div class="ratio ratio-1x1 bg-light d-flex align-items-center justify-content-center rounded-top">
                <span class="text-muted">Brak zdjƒôcia</span>
              </div>
            {% endif %}
          </a>

          <div class="card-body d-flex flex-column text-center">

            <!-- Klikalna nazwa -->
            <a href="{{ url_for('main.product_detail', product_id=product.id) }}" class="text-decoration-none flex-grow-1 d-flex">
              <h6 class="card-title fw-bold text-dark mb-2 align-self-start w-100">{{ product.name }}</h6>
            </a>

            <!-- Klikalna cena, zawsze nad przyciskami -->
            <a href="{{ url_for('main.product_detail', product_id=product.id) }}" class="text-decoration-none">
              <p class="text-success fw-bold fs-5 mb-3 mt-auto">
                {{ "%.2f"|format(product.price) }} z≈Ç
              </p>
            </a>

            <!-- Przyciski -->
            <div>
              {% if session.get("role") == "admin" %}
                <div class="d-flex justify-content-between">
                  <a href="{{ url_for('main.edit_product', product_id=product.id) }}" 
                     class="btn btn-warning w-50 me-1">Edytuj</a>
                  <form method="POST" action="{{ url_for('main.delete_product', product_id=product.id) }}" 
                        class="w-50 ms-1">
                    <button type="submit" class="btn btn-danger w-100">Usu≈Ñ</button>
                  </form>
                </div>
              {% else %}
                {% if cart and (product.id|string) in cart %}
                  <form method="post" action="{{ url_for('main.update_cart', product_id=product.id) }}" 
                        class="d-flex justify-content-center">
                    <div class="btn-group w-100">
                      <button type="submit" name="action" value="decrease" class="btn btn-outline-danger">‚àí</button>
                      <span class="btn btn-light fw-bold disabled">{{ cart[product.id|string] }}</span>
                      <button type="submit" name="action" value="increase" class="btn btn-outline-success">+</button>
                    </div>
                  </form>
                {% else %}
                  <form method="post" action="{{ url_for('main.add_to_cart', product_id=product.id) }}">
                    <button type="submit" class="btn btn-success w-100 rounded-pill">
                      Dodaj do koszyka
                    </button>
                  </form>
                {% endif %}
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p class="text-muted">Brak produkt√≥w w bazie.</p>
  {% endif %}
</div>



{% endblock %}
