{% extends "base.html" %}
{% block content %}
<div class="text-center my-4">
  <h3 class="fw-bold">ðŸ“‹ Podsumowanie zamÃ³wienia</h3>
</div>

<div class="row">
  <div class="col-lg-8 mx-auto">

    <!-- Produkty -->
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-dark text-white">Koszyk</div>
      <ul class="list-group list-group-flush">
        {% for item in items %}
        <li class="list-group-item d-flex justify-content-between">
          <span>{{ item.product.name }} Ã— {{ item.qty }}</span>
          <span class="fw-bold">{{ "%.2f"|format(item.subtotal) }} zÅ‚</span>
        </li>
        {% endfor %}
      </ul>
    </div>

    <!-- Dostawa i pÅ‚atnoÅ›Ä‡ -->
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-dark text-white">Dostawa i pÅ‚atnoÅ›Ä‡</div>
      <div class="card-body">
        <p><b>Dostawa:</b>
            {% if session.get("checkout_delivery") == "kurier" %}
                Kurier â€“ 14 zÅ‚
            {% else %}
                OdbiÃ³r osobisty
            {% endif %}
            </p>

            <p><b>PÅ‚atnoÅ›Ä‡:</b>
            {% if session.get("checkout_payment") == "blik" %}
                BLIK
            {% else %}
                Przy odbiorze
            {% endif %}
        </p>
      </div>
    </div>

    <!-- Suma -->
    <div class="card shadow-sm mb-4">
      <div class="card-body text-end">
        <h4>Razem: <span class="text-success">{{ "%.2f"|format(total) }} zÅ‚</span></h4>
      </div>
    </div>

    {% if session.get("checkout_payment") == "blik" %}
    <button class="btn btn-success w-100" data-bs-toggle="modal" data-bs-target="#blikModal">
      ðŸ’³ KupujÄ™ i pÅ‚acÄ™
    </button>

    <!-- Modal BLIK -->
    <div class="modal fade" id="blikModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-dark text-white">
            <h5 class="modal-title">PÅ‚atnoÅ›Ä‡ BLIK</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <form method="post">
            <div class="modal-body">
              <label>Wpisz 6-cyfrowy kod:</label>
              <input type="text" name="blik_code" maxlength="6" pattern="\d{6}" required class="form-control">
              <div class="mt-3 text-center d-none" id="loading">
                <div class="spinner-border text-success"></div>
                <p class="mt-2">Przetwarzanie pÅ‚atnoÅ›ci...</p>
              </div>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-success w-100" onclick="document.getElementById('loading').classList.remove('d-none');">
                âœ… ZapÅ‚aÄ‡
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    {% else %}
    <form method="post">
      <button type="submit" class="btn btn-success w-100">âœ… KupujÄ™ i pÅ‚acÄ™</button>
    </form>
    {% endif %}

  </div>
</div>
{% endblock %}
